<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Transportation Methods for Econometrics">
    <meta name="author" content="Keith O'Hara">

    <meta name="keywords" content="TraME, Transportation Methods, Optimal Transport, R, C++, Cpp, Econometrics, Research, Alfred Galichon, Keith O'Hara, NYU, New York University" />

    <link rel="shortcut icon" type="image/x-icon" href="siteicon.ico">

    <title>Transportation Methods for Econometrics (TraME)</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/modern-business.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- Syntax Highlighter -->
    <script type="text/javascript" src="js/syntaxhighlighter.js"></script>
    <link type="text/css" rel="stylesheet" href="css/swift_theme.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <!--<a class="navbar-brand" href="http://www.trame-project.com" style="color:white">TraME</a>-->
                <a class="navbar-left" href="http://www.trame-project.com"><img class="img" src="pics/monge_thumb.png" alt="" width="50" height="50"></a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="about.html">About</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Versions<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="trame.html">C++</a>
                            </li>
                            <li>
                                <a href="trame_r.html">R</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container">

        <!-- Page Heading/Breadcrumbs -->
        <div class="row">
            <div class="col-lg-12">
                <ol class="breadcrumb">
                    <li><a href="http://www.trame-project.com">Home</a></li>
                    <li><a href="trame.html">TraME</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">ARUMs <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="trame_docs_arums.html">ARUMs</a></li>
                            <li class="divider"></li>
                            <li><a href="trame_docs_arums_empirical.html">Empirical</a></li>
                            <li><a href="trame_docs_arums_logit.html">Logit</a></li>
                            <li><a href="trame_docs_arums_none.html">None</a></li>
                            <li><a href="trame_docs_arums_probit.html">Probit</a></li>
                            <li class="active"><a href="trame_docs_arums_rsc.html">RSC</a></li>
                            <li><a href="trame_docs_arums_rusc.html">RUSC</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">MMFs <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="trame_docs_mmfs.html">MMFs</a></li>
                            <li class="divider"></li>
                            <li><a href="trame_docs_mmfs_cd.html">CD</a></li>
                            <li><a href="trame_docs_mmfs_ces.html">CES</a></li>
                            <li><a href="trame_docs_mmfs_geo.html">Geo</a></li>
                            <li><a href="trame_docs_mmfs_min.html">Min</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Transfers <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="trame_docs_transfers.html">Transfers</a></li>
                            <li class="divider"></li>
                            <li><a href="trame_docs_transfers_etu.html">ETU</a></li>
                            <li><a href="trame_docs_transfers_ltu.html">LTU</a></li>
                            <li><a href="trame_docs_transfers_ntu.html">NTU</a></li>
                            <li><a href="trame_docs_transfers_tu.html">TU</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Markets <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="trame_docs_markets.html">Markets</a></li>
                            <li class="divider"></li>
                            <li><a href="trame_docs_markets_dse.html">DSE</a></li>
                            <li><a href="trame_docs_markets_mfe.html">MFE</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Solvers <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="trame_docs_solvers.html">Solvers</a></li>
                            <li class="divider"></li>
                            <li><a href="trame_docs_solvers_arc_newton.html">Arc Newton</a></li>
                            <li><a href="trame_docs_solvers_cupids_lp.html">Cupids LP</a></li>
                            <li><a href="trame_docs_solvers_darum.html">DA RUM</a></li>
                            <li><a href="trame_docs_solvers_eap_nash.html">EAP Nash</a></li>
                            <li><a href="trame_docs_solvers_ipfp.html">IPFP</a></li>
                            <li><a href="trame_docs_solvers_jacobi.html">Jacobi</a></li>
                            <li><a href="trame_docs_solvers_max_welfare.html">Max Welfare</a></li>
                            <li><a href="trame_docs_solvers_nodal_newton.html">Nodal Newton</a></li>
                            <li><a href="trame_docs_solvers_oap_lp.html">OAP LP</a></li>
                        </ul>
                    </li>
                    <li><a href="trame_docs_models.html">Models</a></li>
                </ol>
            </div>
        </div>
        <!-- /.row -->


<h3 style="text-align: center;"><strong style="font-size: 130%;">Additive Random Utility Models (ARUMs)</strong></h3>
<hr>

<p> &nbsp </p>

<h3 style="text-align: left;"><strong style="font-size: 120%;">Random Scalar Coefficient (RSC) Class</strong></h3>

<div class="row">
<div class="col-md-4">
    <div class="panel panel-default">
    <div class="panel-body">
        <a href="#CD">Class Definition</a> <br>
        <a href="#MO">Member Objects</a> <br>
        <a href="#MF">Member Functions</a> <br>
        <a href="#NTS">Notes</a> <br>
        <a href="#EX">Example</a> <br>
    </div>
    </div>
</div>
</div>

<hr>

<h3 style="text-align: left;"><strong style="font-size: 120%;">Class Definition</strong></h3>

<p>Definition:</p>
<pre class="brush: cpp;"> 
class rsc
{
    public:
        // build objects
        int nbX;
        int nbY;
        int nbParams;
        bool outsideOption;
        
        double* dist_pars;
        
        arma::mat zeta;
        arma::mat aux_ord;
        
        arma::cube aux_Influence_lhs;
        arma::cube aux_Influence_rhs;
        
        arma::cube aux_DinvPsigma; 
        arma::cube aux_Psigma;
        
        double   (*aux_cdf_eps)(double x, double* dist_pars);
        double (*aux_quant_eps)(double x, double* dist_pars);
       
        double (*aux_pdf_eps)(double x, double* dist_pars);
        double (*aux_pot_eps)(double x, double* dist_pars);
        
        arma::vec   (*aux_cdf_eps_vec)(arma::vec x, double* dist_pars);
        arma::vec (*aux_quant_eps_vec)(arma::vec x, double* dist_pars);
       
        arma::vec (*aux_pdf_eps_vec)(arma::vec x, double* dist_pars);
        arma::vec (*aux_pot_eps_vec)(arma::vec x, double* dist_pars);
        
        // input objects
        arma::mat U;
        arma::mat mu;
        
        // equilibrium objects
        arma::mat U_sol;
        arma::mat mu_sol;
        
        // member functions
        ~rsc(){};
         rsc(){};
        explicit rsc(int nbX_inp, int nbY_inp);
        explicit rsc(arma::mat zeta_inp, bool outsideOption_inp);
        explicit rsc(arma::mat zeta_inp, double alpha, double beta);

        void build(int nbX_inp, int nbY_inp);
        void build(arma::mat zeta_inp, bool outsideOption_inp);

        void build_beta(arma::mat zeta_inp, double alpha, double beta);
        
        double G(const arma::vec& n);
        double G(const arma::vec& n, const arma::mat& U_inp, arma::mat& mu_out);
        double Gx(const arma::mat& U_x_inp, arma::mat& mu_x_out, int x);
        
        double Gstar(const arma::vec& n);
        double Gstar(const arma::vec& n, const arma::mat& mu_inp, arma::mat& U_out);
        double Gstarx(const arma::mat& mu_x_inp, arma::mat &U_x_out, int x);

        double Gbar(const arma::mat& Ubar, const arma::mat& mubar, const arma::vec& n, arma::mat& U_out, arma::mat& mu_out);
        double Gbarx(const arma::vec& Ubar_x, const arma::vec& mubar_x, arma::mat& U_x_out, arma::mat& mu_x_out, int x);
        
        arma::mat D2Gstar(const arma::vec& n, bool xFirst);
        void D2Gstar(arma::mat &H, const arma::vec& n, bool xFirst);
        void D2Gstar(arma::mat &H, const arma::vec& n, const arma::mat& mu_inp, bool xFirst);

        void dtheta_NablaGstar(arma::mat& ret, const arma::vec& n, arma::mat* dtheta, bool x_first);
        
        empirical simul();
        empirical simul(int* nbDraws, int* seed);
        void simul(empirical& obj_out);
        void simul(empirical& obj_out, int* nbDraws, int* seed);
        
    private:
        double cdf (double x);
        arma::vec cdf (arma::vec x);
        double pdf (double x);
        arma::vec pdf (arma::vec x);
        double quantile (double x);
        arma::vec quantile (arma::vec x);
        double pot (double x);
        arma::vec pot (arma::vec x);

        static double Gbar_opt_objfn(const arma::vec& vals_inp, arma::vec* grad, void* opt_data);
        static double Gbar_opt_constr(const arma::vec& vals_inp, arma::vec* grad, void* constr_data);

        static double Gstarx(arma::vec& U_x, const arma::vec& mu_x_inp, const arma::mat& zeta,
                             const arma::mat& aux_DinvPsigma, const arma::mat& aux_Psigma,
                             const arma::mat& aux_Influence_lhs, const arma::mat& aux_Influence_rhs,
                             arma::vec (*pot_eps_vec)(arma::vec pot_inp, double* dist_pars),
                             arma::vec (*quantile_eps_vec)(arma::vec quant_inp, double* dist_pars),
                             double* dist_pars, int nbY, int x);
};</pre>

<hr>

<h3 style="text-align: left;" id="MO"><strong style="font-size: 120%;">Member Objects</strong></h3>

<hr>

<h3 style="text-align: left;" id="MF"><strong style="font-size: 120%;">Member Functions</strong></h3>

<hr>

<h3 style="text-align: left;" id="NTS"><strong style="font-size: 120%;">Notes</strong></h3>

<hr>

<h3 style="text-align: left;" id="EX"><strong style="font-size: 120%;">Examples</strong></h3>

<p>Example:</p>

<pre class="brush: cpp;"> 
    arma::mat U(2,3);
    U  << 1.6 << 3.2 << 1.1 << arma::endr
       << 2.9 << 1.0 << 3.1 << arma::endr;

    arma::mat mu(2,3);
    mu << 1.0 << 3.0 << 1.0 << arma::endr
       << 2.0 << 1.0 << 3.0 << arma::endr;
    //
    // setup RSC class object
    int nbX = U.n_rows;
    int nbY = U.n_cols;

    arma::vec n = arma::sum(mu,1) + 1.0;

    arma::mat z_temp(1,nbY+1);
    z_temp(0,0) = 0.1; z_temp(0,1) = 0.2; z_temp(0,2) = 0.3; z_temp(0,3) = 0.0;

    arma::mat zeta = arma::ones(nbX,1) * z_temp;

    arma::cout << "zeta: \n" << zeta << arma::endl;
    //
    // RSC object
    trame::rsc rsc_obj;
    rsc_obj.U = U;
    rsc_obj.mu = mu;

    rsc_obj.build_beta(zeta,2.0,2.0);
    //
    // empirical object:
    int sim_seed = 1777;
    int n_draws = 1000;
    trame::empirical rsc_sim;
    
    rsc_obj.simul(rsc_sim, &n_draws, &sim_seed);
    
    rsc_sim.U = U;
    rsc_sim.mu = mu;
    //
    // first compute optimal assignment (mu)
    double G_val = rsc_obj.G(n);
    double G_sim_val = rsc_sim.G(n);

    std::cout << "G(U) and G-sim(U): \n" << G_val << " and " << G_sim_val << std::endl;

    arma::cout << "\nG -> mu: \n" << rsc_obj.mu_sol << arma::endl;
    arma::cout << "G-sim -> mu: \n" << rsc_sim.mu_sol << arma::endl;
    //
    // solution to dual problem U*
    double Gstar_val = rsc_obj.Gstar(n);
    double Gstar_sim_val = rsc_sim.Gstar(n);

    std::cout << "G*(mu) and G*-sim(mu): \n" << Gstar_val << " and " << Gstar_sim_val << std::endl;

    arma::cout << "\n\\nabla G*(\\nabla G(U)): \n" << rsc_obj.U_sol << arma::endl;
    arma::cout << "\\nabla G-sim*(\\nabla G-sim(U)): \n" << rsc_sim.U_sol << arma::endl;
    //
    // Gbar
    arma::mat mu_bar(2,3);
    mu_bar.fill(2);
    
    arma::mat U_bar_temp, mu_bar_temp;
    arma::mat U_bar_sim_temp, mu_bar_sim_temp;
    
    double val_Gbar = rsc_obj.Gbar(U,mu_bar,n,U_bar_temp,mu_bar_temp);
    double val_Gbar_sim = rsc_sim.Gbar(U,mu_bar,n,U_bar_sim_temp,mu_bar_sim_temp);

    std::cout << "Gbar val: \n" << val_Gbar << std::endl;
    std::cout << "Gbar-sim val: \n" << val_Gbar_sim << std::endl;
</pre>

    <hr>

        <!-- Footer -->
        <footer>
            <div class="row">
                <div class="col-lg-12">
                    <p>Copyright &copy; TraME Group 2017</p>
                </div>
            </div>
        </footer>

    </div>
    <!-- /.container -->

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

</body>

</html>
